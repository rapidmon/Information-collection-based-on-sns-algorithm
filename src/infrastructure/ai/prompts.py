"""OpenAI API 프롬프트 템플릿.

system 프롬프트로 역할/출력 규칙을 고정하고,
user 프롬프트에 데이터와 작업 지시를 분리하여 문맥 일관성을 유지한다.
모든 프롬프트는 JSON 응답을 요구하여 구조적 파싱이 가능하도록 설계.
"""

SYSTEM_PROMPT = """당신은 전문 기술 뉴스 분석가이자 편집자입니다. 아래 규칙을 항상 엄격히 따르세요.

## 핵심 규칙
1. **응답은 반드시 순수 JSON 배열**로만 출력하세요. 설명, 주석, 마크다운 코드블록(```) 없이 `[`로 시작하고 `]`로 끝나야 합니다.
2. **모든 텍스트 출력은 한국어**로 작성하세요. 고유명사(기업명, 기술명)만 영문 그대로 유지합니다.
3. **구체적 사실 중심**: 요약 시 모호한 표현 대신 수치, 기업명, 제품명 등 구체적 사실을 포함하세요.
4. **중립적 톤 유지**: 개인 의견이나 감정 표현 없이 객관적으로 분석하세요.

## 카테고리 정의
- AI: 인공지능, LLM, 머신러닝, AI 서비스, AI 칩, AI 에이전트
- Semiconductor: 반도체, 칩, 파운드리, HBM, GPU, 메모리, TSMC, 삼성전자 반도체
- Cloud: 클라우드 컴퓨팅, 데이터센터, AWS/Azure/GCP, 인프라
- Startup: 스타트업, 투자, 펀딩, 인수합병, VC
- BigTech: 빅테크 기업 전략 (Google, Apple, Meta, Amazon, Microsoft, Nvidia 등)
- Regulation: 기술 규제, 정책, 법률, 수출 통제
- Coding: 프로그래밍, 개발 도구, 프레임워크, 오픈소스, DevOps, 개발자 생태계

## 중요도 기준 (반드시 차등 부여, 전부 0.5로 몰리면 안 됨)
- 0.9-1.0: 산업 판도를 바꾸는 뉴스 (예: ChatGPT 출시, Nvidia 시총 1위, 대규모 M&A)
- 0.7-0.89: 주요 뉴스 (예: 신제품 출시, 대형 투자 라운드, 분기 실적 서프라이즈)
- 0.5-0.69: 의미있는 뉴스 (예: 기능 업데이트, 파트너십, 소규모 인수)
- 0.3-0.49: 일반 정보 (예: 팁/가이드, 의견글, 루머, 소소한 발표)
- 0.0-0.29: 낮은 중요도 (예: 밈, 잡담, 자기 홍보)"""


FILTER_AND_SUMMARIZE = """아래 소셜 미디어 게시물들의 기술 산업 관련성을 판단하고 요약하세요.

## 관련성 판단 기준 (엄격하게 적용)

### 관련 있음 (true):
- 구체적 기술 뉴스/발표 (제품, 서비스, 기술적 성과)
- 업계 동향/분석 (실적, 투자, 인수, 전략)
- 기술적 인사이트/설명 (아키텍처, 벤치마크, 비교)
- 개발 도구/프레임워크/오픈소스 관련 실질적 정보

### 관련 없음 (false) — 반드시 걸러내세요:
- 개인 일상, 감정, 인사 ("좋은 아침", "피곤하다", "축하합니다")
- 단순 밈, 유머, 잡담
- 기술과 무관한 정치/사회/연예 이야기
- 구체적 내용 없이 링크만 있거나 "이거 봤어?" 같은 짧은 반응
- 자기 홍보/마케팅 (채용, 이벤트, "팔로우 해주세요")
- 기술 키워드가 있지만 실질 정보가 없는 감상/소감문

## 작업
각 게시물에 대해:
1. **관련성**: 위 기준으로 엄격히 판단. 확신이 없으면 false로 처리하세요.
2. **한국어 요약**: 관련 있는 게시물만 1-2문장 핵심 요약. 반드시 구체적 수치/기업명/제품명 포함. 관련 없으면 null.
3. **언어**: 원문 언어 (ko/en/etc)

## 게시물 목록
{posts_json}

## 출력 형식
[
  {{
    "post_id": "...",
    "is_relevant": true,
    "summary": "한국어 요약...",
    "language": "ko"
  }}
]"""


CATEGORIZE = """아래 게시물들을 카테고리로 분류하고 중요도를 매기세요.

## 핵심 지시
- 중요도 점수를 **반드시 차등 부여**하세요. 모든 게시물에 0.5를 주지 마세요.
- 뉴스 가치를 기준으로: 구체적 발표/수치가 있으면 높게, 의견/감상이면 낮게.
- 같은 배치 내에서 상대적으로도 비교하여 점수를 분배하세요.

## 중요도 판단 예시
- "OpenAI, GPT-5 출시" → 0.95 (산업 판도 변화)
- "삼성전자 HBM3E 양산 시작" → 0.85 (주요 기술 발표)
- "GitHub Copilot 새 기능 추가" → 0.6 (의미있는 업데이트)
- "Next.js vs Remix 비교글" → 0.4 (참고 정보)
- "AI 시대에 개발자 어떻게 살아남을까 (의견)" → 0.3 (개인 의견)

## 작업
각 게시물에 대해:
1. **카테고리**: 7개 카테고리 중 해당하는 것을 모두 선택 (복수 가능)
2. **중요도**: 0.0-1.0 점수. 위 예시와 기준을 참고하여 차등 부여하세요.
3. **키워드**: 게시물의 핵심 내용을 대표하는 키워드 3-5개를 추출하세요.
   - 카테고리명(AI, Semiconductor 등)은 키워드에 포함하지 마세요.
   - 기업명, 제품명, 기술명, 수치 등 구체적인 고유명사 위주로 추출하세요.
   - 예시: ["GPT-5", "OpenAI", "멀티모달", "100B 파라미터"], ["TSMC", "3nm", "양산", "Apple"]

## 게시물 목록
{posts_json}

## 출력 형식
[
  {{
    "post_id": "...",
    "categories": ["AI", "Semiconductor"],
    "importance_score": 0.85,
    "keywords": ["GPT-5", "OpenAI", "멀티모달"]
  }}
]"""


DEDUPLICATE_AND_MERGE = """아래 게시물 목록에서 동일한 사건/주제를 다루는 항목들을 그룹으로 묶고, 각 그룹에 대해 통합 브리핑 항목을 생성하세요.

## 작업
1. 같은 사건/주제를 다루는 게시물을 하나의 그룹으로 묶으세요.
2. 각 그룹에 대해:
   - **통합 헤드라인**: 한국어, 명확하고 구체적 (예: "ByteDance, 자체 AI 칩 'SeedChip' 개발 본격화")
   - **통합 본문**: 불릿 포인트 3-5개. 구체적 수치와 사실 중심. 여러 출처의 고유 정보를 모두 포함.
   - **주요 카테고리**: 7개 중 가장 적합한 하나
   - **중요도**: 0.0-1.0 (차등 부여)
   - **출처**: 어떤 소스에서 왔는지
3. 단독 주제(그룹이 1개인 경우)도 동일 형식으로 출력하세요.

## 게시물 목록
{posts_json}

## 출력 형식
[
  {{
    "post_ids": ["id1", "id5", "id12"],
    "headline": "ByteDance, 자체 AI 칩 'SeedChip' 개발 본격화",
    "body_bullets": [
      "ByteDance가 AI 추론용 자체 칩 'SeedChip' 개발 중 - 2026년 최소 10만개 생산 목표",
      "삼성전자와 위탁생산 협상 진행 중, HBM 물량 확보도 동시 논의",
      "올해 AI 관련 22조원 이상 투자 예정이나 절반은 여전히 Nvidia GPU 구매에 사용"
    ],
    "primary_category": "Semiconductor",
    "importance_score": 0.92,
    "sources": ["twitter", "dcinside"]
  }}
]"""
